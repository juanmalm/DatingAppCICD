trigger:
  branches:
    include:
    - '*'

pr:
  branches:
    include:
    - main

pool:
  vmImage: windows-2022

stages:

# Etapa de commit. Incluye los procesos de compilación, test unitarios, evaluación del código y empaquetado
- stage: Etapa_Commit
  jobs:

  # Job para el cliente en Angular
  - job: Cliente_Angular
    steps:
    - template: templates/cliente_commit_stage.yml

  # Job para el API en .NET
  - job: API_NET
    steps:
    - template: templates/api_commit_stage.yml

# Etapa de test de aceptación automáticos
- stage: Etapa_Test_Aceptacion
  condition: and(succeeded(), eq(variables['build.sourceBranch'], 'refs/heads/main'))
  jobs:
  - job: Etapa_Test_Aceptacion
    steps:
    - template: templates/test_aceptacion.yml