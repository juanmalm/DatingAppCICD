steps:

# Desplegar entorno test
#- task: PowerShell@2
#  displayName: '[Test aceptaci√≥n 6/9]: Crear imagen con Packer'
#  inputs:
#    targetType: 'inline'
#    script: |
#      Invoke-WebRequest -Uri https://releases.hashicorp.com/packer/1.9.1/packer_1.9.1_windows_amd64.zip -OutFile .azpipelines\packer\packer_1.9.1_windows_amd64.zip
#      Expand-Archive .azpipelines\packer\packer_1.9.1_windows_amd64.zip -DestinationPath .azpipelines\packer\
#      .\.azpipelines\packer\packer.exe build -force `
#          -var "SubscriptionId=$(SubscriptionId)" `
#          -var "TenantId=$(TenantId)" `
#          -var "ClientId=$(ClientId)" `
#          -var "ClientSecret=$(ClientSecret)" `
#          -var "ImageName=DatingApp_$(Build.BuildNumber)" `
#          -var "ResourceGroupName=$(ResourceGroupName)" `
#          .azpipelines\packer\despliegue.json

- task: PackerBuild@1
  displayName: '[Empaquetado 1/1]: Crear imagen con Packer'
  inputs:
    templateType: 'custom'
    customTemplateLocation: '.azpipelines/packer/despliegue.json'
    customTemplateParameters: '{
      "SubscriptionId": "$(SubscriptionId)",
      "TenantId": "$(TenantId)",
      "ClientId": "$(ClientId)",
      "ClientSecret": "$(ClientSecret)",
      "ImageName": "DatingApp_$(Build.BuildNumber)",
      "ResourceGroupName": "$(ResourceGroupName)"}'